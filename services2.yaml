[
  {
    "name": "Service configuration. Depends on docker",
    "hosts": "rpi4",
    "remote_user": "lina",
    "tasks":
      [
        {
          "name": "Ensure jackett config directory",
          "file":
            {
              "path": "/var/lib/jackett",
              "state": "directory",
              "mode": "0750",
            },
          "become": true,
        },
        {
          "name": "Run jackett container",
          "community.docker.docker_container":
            {
              "name": "jackett",
              "image": "lscr.io/linuxserver/jackett:latest",
              "restart_policy": "unless-stopped",
              "published_ports": ["9117:9117"],
              "volumes": ["/var/lib/jackett:/config"],
              "networks": [{ "name": "torrent" }],
            },
        },
        {
          "name": "Create jellyfin config volume",
          "community.docker.docker_volume": { "name": "jellyfin-config" },
        },
        {
          "name": "Run jellyfin container",
          "community.docker.docker_container":
            {
              "name": "jellyfin",
              "image": "jellyfin/jellyfin:latest",
              "restart_policy": "unless-stopped",
              "network_mode": "host",
              "volumes": ["jellyfin-config:/config"],
              "mounts":
                [
                  {
                    "source": "/srv/downloads",
                    "target": "/media",
                    "type": "bind",
                  },
                ],
              "user": "65534:65534",
            },
        },
      ],
  },
]
